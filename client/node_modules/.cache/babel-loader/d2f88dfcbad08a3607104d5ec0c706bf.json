{"ast":null,"code":"import _slicedToArray from\"/Users/max/dev/listening-party/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,createContext,useContext}from\"react\";import axios from'axios';import API_ENDPOINTS from'../endpoints';import{getHashParams}from'../helpers/helpers';var UserContext=createContext({user:undefined,logout:function logout(){}});var UserProvider=function UserProvider(_ref){var children=_ref.children;var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var checkLogIn=function checkLogIn(){var savedUser=localStorage.getItem('user');if(savedUser){setUser(JSON.parse(savedUser));return;}if(!window.location.hash)return;login();};useEffect(checkLogIn,[]);var login=function login(){var locationArgs=getHashParams(window.location.hash);axios.defaults.headers.common['Authorization']='Bearer '+locationArgs.access_token;axios.get(API_ENDPOINTS.ME).then(function(res){console.log(res.data);var user=res.data;setUser(user);localStorage.setItem('user',JSON.stringify(user));// socket.emit('newconnection', user);\n});};var logout=function logout(){setUser(undefined);localStorage.clear();};var SettingsContext={user:user,logout:logout};return/*#__PURE__*/React.createElement(UserContext.Provider,{value:SettingsContext},children);};var useUser=function useUser(){return useContext(UserContext);};export{UserProvider,useUser};","map":{"version":3,"sources":["/Users/max/dev/listening-party/client/src/contexts/UserContext.tsx"],"names":["React","useState","useEffect","createContext","useContext","axios","API_ENDPOINTS","getHashParams","UserContext","user","undefined","logout","UserProvider","children","setUser","checkLogIn","savedUser","localStorage","getItem","JSON","parse","window","location","hash","login","locationArgs","defaults","headers","common","access_token","get","ME","then","res","console","log","data","setItem","stringify","clear","SettingsContext","useUser"],"mappings":"wHAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAkDC,aAAlD,CAAiEC,UAAjE,KAAmF,OAAnF,CAEA,MAAOC,CAAAA,KAAP,KAAqC,OAArC,CAEA,MAAOC,CAAAA,aAAP,KAA0B,cAA1B,CAEA,OAASC,aAAT,KAA8B,oBAA9B,CAaA,GAAMC,CAAAA,WAAW,CAAGL,aAAa,CAAc,CAC3CM,IAAI,CAAEC,SADqC,CAE3CC,MAAM,CAAE,iBAAM,CAAG,CAF0B,CAAd,CAAjC,CAKA,GAAMC,CAAAA,YAAsB,CAAG,QAAzBA,CAAAA,YAAyB,MAAsC,IAAnCC,CAAAA,QAAmC,MAAnCA,QAAmC,eACzCZ,QAAQ,EADiC,wCAC1DQ,IAD0D,eACpDK,OADoD,eAGjE,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAY,CAC3B,GAAMC,CAAAA,SAAS,CAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAlB,CACA,GAAIF,SAAJ,CAAe,CACXF,OAAO,CAACK,IAAI,CAACC,KAAL,CAAWJ,SAAX,CAAD,CAAP,CACA,OACH,CAED,GAAI,CAACK,MAAM,CAACC,QAAP,CAAgBC,IAArB,CAA2B,OAC3BC,KAAK,GACR,CATD,CAWAtB,SAAS,CAACa,UAAD,CAAa,EAAb,CAAT,CAEA,GAAMS,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,EAAY,CACtB,GAAIC,CAAAA,YAA4B,CAAGlB,aAAa,CAACc,MAAM,CAACC,QAAP,CAAgBC,IAAjB,CAAhD,CACAlB,KAAK,CAACqB,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,eAA9B,EAAiD,UAAYH,YAAY,CAACI,YAA1E,CACAxB,KAAK,CAACyB,GAAN,CAAUxB,aAAa,CAACyB,EAAxB,EAA4BC,IAA5B,CAAiC,SAACC,GAAD,CAA8B,CAC3DC,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACG,IAAhB,EACA,GAAM3B,CAAAA,IAAI,CAAGwB,GAAG,CAACG,IAAjB,CACAtB,OAAO,CAACL,IAAD,CAAP,CACAQ,YAAY,CAACoB,OAAb,CAAqB,MAArB,CAA6BlB,IAAI,CAACmB,SAAL,CAAe7B,IAAf,CAA7B,EACA;AACH,CAND,EAOH,CAVD,CAYA,GAAME,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAY,CACvBG,OAAO,CAACJ,SAAD,CAAP,CACAO,YAAY,CAACsB,KAAb,GACH,CAHD,CAKA,GAAMC,CAAAA,eAAe,CAAG,CACpB/B,IAAI,CAAJA,IADoB,CAEpBE,MAAM,CAANA,MAFoB,CAAxB,CAKA,mBACI,oBAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE6B,eAA7B,EACK3B,QADL,CADJ,CAKH,CA3CD,CA6CA,GAAM4B,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,SAAMrC,CAAAA,UAAU,CAACI,WAAD,CAAhB,EAAhB,CACA,OAASI,YAAT,CAAuB6B,OAAvB","sourcesContent":["import React, { useState, useEffect, useCallback, createContext, useContext } from \"react\";\n\nimport axios, { AxiosResponse } from 'axios';\nimport { User } from '../../../models/User';\nimport API_ENDPOINTS from '../endpoints'\n\nimport { getHashParams } from '../helpers/helpers';\n\ninterface AuthHashParams {\n    access_token: string;\n    token_type: string;\n}\n\n\nexport interface UserContext {\n    user: User | undefined;\n    logout: () => void;\n}\n\nconst UserContext = createContext<UserContext>({\n    user: undefined,\n    logout: () => { },\n});\n\nconst UserProvider: React.FC = ({ children }): React.ReactElement => {\n    const [user, setUser] = useState<User>();\n\n    const checkLogIn = (): void => {\n        const savedUser = localStorage.getItem('user');\n        if (savedUser) {\n            setUser(JSON.parse(savedUser));\n            return;\n        }\n\n        if (!window.location.hash) return;\n        login();\n    }\n\n    useEffect(checkLogIn, [])\n\n    const login = (): void => {\n        let locationArgs: AuthHashParams = getHashParams(window.location.hash);\n        axios.defaults.headers.common['Authorization'] = 'Bearer ' + locationArgs.access_token;\n        axios.get(API_ENDPOINTS.ME).then((res: AxiosResponse<User>) => {\n            console.log(res.data);\n            const user = res.data;\n            setUser(user)\n            localStorage.setItem('user', JSON.stringify(user));\n            // socket.emit('newconnection', user);\n        });\n    }\n\n    const logout = (): void => {\n        setUser(undefined);\n        localStorage.clear();\n    }\n\n    const SettingsContext = {\n        user,\n        logout\n    }\n\n    return (\n        <UserContext.Provider value={SettingsContext}>\n            {children}\n        </UserContext.Provider>\n    );\n};\n\nconst useUser = () => useContext(UserContext);\nexport { UserProvider, useUser };\n\n"]},"metadata":{},"sourceType":"module"}