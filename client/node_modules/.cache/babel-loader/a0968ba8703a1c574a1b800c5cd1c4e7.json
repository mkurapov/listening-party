{"ast":null,"code":"import _slicedToArray from\"/Users/max/dev/listening-party/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import'./App.css';import io from'socket.io-client';import API_ENDPOINTS from'./endpoints';import axios from'axios';import{Switch,Route}from'react-router-dom';import Button from'./components/Button';import{getHashParams}from'./helpers/helpers';// import { AuthContext, Create } from './contexts/AuthContext';\nvar UserContext=React.createContext(undefined);function App(){var APP_URL='http://localhost:8080';var LOGIN_URL=APP_URL+'/login';var _useState=useState([]),_useState2=_slicedToArray(_useState,2),otherUsers=_useState2[0],setOtherUsers=_useState2[1];var socket=io(APP_URL);socket.on('party-created',function(party){console.log(party);});useEffect(function(){},[]);var _React$useState=React.useState(),_React$useState2=_slicedToArray(_React$useState,2),user=_React$useState2[0],setUser=_React$useState2[1];var checkLogIn=function checkLogIn(){var savedUser=localStorage.getItem('user');if(savedUser){setUser(JSON.parse(savedUser));return;}if(!window.location.hash)return;login();};useEffect(checkLogIn,[]);var logout=function logout(){setUser(undefined);localStorage.clear();};var login=function login(){var locationArgs=getHashParams(window.location.hash);axios.defaults.headers.common['Authorization']='Bearer '+locationArgs.access_token;axios.get(API_ENDPOINTS.ME).then(function(res){console.log(res.data);var user=res.data;setUser(user);localStorage.setItem('user',JSON.stringify(user));// socket.emit('newconnection', user);\n});};var createRoom=function createRoom(){socket.emit('party-create',socket.id);};return/*#__PURE__*/React.createElement(UserContext.Provider,{value:user},/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(\"header\",{className:\"App-header\"}),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/\"},user&&user.id?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",null,\"Hi, \",user.id,\"!\"),/*#__PURE__*/React.createElement(Button,{name:\"Logout\",onClick:logout}),/*#__PURE__*/React.createElement(Button,{name:\"Create new Room\",onClick:createRoom}),otherUsers.map(function(u){return/*#__PURE__*/React.createElement(\"span\",null,u.id);})):/*#__PURE__*/React.createElement(\"a\",{href:LOGIN_URL},\"Login\")))));}export default App;","map":{"version":3,"sources":["/Users/max/dev/listening-party/client/src/App.tsx"],"names":["React","useEffect","useState","io","API_ENDPOINTS","axios","Switch","Route","Button","getHashParams","UserContext","createContext","undefined","App","APP_URL","LOGIN_URL","otherUsers","setOtherUsers","socket","on","party","console","log","user","setUser","checkLogIn","savedUser","localStorage","getItem","JSON","parse","window","location","hash","login","logout","clear","locationArgs","defaults","headers","common","access_token","get","ME","then","res","data","setItem","stringify","createRoom","emit","id","map","u"],"mappings":"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","sourcesContent":["import React, { createContext, useEffect, useState } from 'react';\nimport './App.css';\nimport io from 'socket.io-client'\nimport API_ENDPOINTS from './endpoints'\n\nimport axios, { AxiosResponse } from 'axios';\n\nimport { Switch, Route, useHistory } from 'react-router-dom';\nimport Home from './pages/authenticated/Home';\nimport { User, Party } from '../../models/User';\nimport Button from './components/Button';\nimport { getHashParams } from './helpers/helpers';\n// import { AuthContext, Create } from './contexts/AuthContext';\n\n\nconst UserContext = React.createContext<SpotifyUser | undefined>(undefined);\ninterface AuthHashParams {\n  access_token: string;\n  token_type: string;\n}\n\ninterface SpotifyUser {\n  id: string;\n  display_name: string;\n}\n\nfunction App() {\n  const APP_URL = 'http://localhost:8080'\n  const LOGIN_URL = APP_URL + '/login';\n  const [otherUsers, setOtherUsers] = useState<SpotifyUser[]>([]);\n\n  const socket = io(APP_URL);\n  socket.on('party-created', (party: Party) => {\n    console.log(party);\n  });\n\n  useEffect(() => {\n\n  }, []);\n\n\n  const [user, setUser] = React.useState<SpotifyUser>();\n\n  const checkLogIn = (): void => {\n    const savedUser = localStorage.getItem('user');\n    if (savedUser) {\n      setUser(JSON.parse(savedUser));\n      return;\n    }\n\n    if (!window.location.hash) return;\n    login();\n  }\n\n  useEffect(checkLogIn, [])\n\n  const logout = (): void => {\n    setUser(undefined);\n    localStorage.clear();\n  }\n\n  const login = (): void => {\n    let locationArgs: AuthHashParams = getHashParams(window.location.hash);\n    axios.defaults.headers.common['Authorization'] = 'Bearer ' + locationArgs.access_token;\n    axios.get(API_ENDPOINTS.ME).then((res: AxiosResponse<SpotifyUser>) => {\n      console.log(res.data);\n      const user = res.data;\n      setUser(user)\n      localStorage.setItem('user', JSON.stringify(user));\n      // socket.emit('newconnection', user);\n    });\n  }\n\n  const createRoom = (): void => {\n    socket.emit('party-create', socket.id);\n  }\n\n\n\n  return (\n    <UserContext.Provider value={user}>\n      <div className=\"App\">\n        <header className=\"App-header\">\n        </header>\n        <Switch>\n          <Route exact path='/'>\n            {user && user.id ?\n              <div>\n                <div>Hi, {user.id}!</div>\n                <Button name=\"Logout\" onClick={logout}></Button>\n                <Button name=\"Create new Room\" onClick={createRoom}></Button>\n                {otherUsers.map((u: SpotifyUser) => <span>{u.id}</span>)}\n              </div>\n              :\n              <a href={LOGIN_URL}>Login</a>\n            }\n          </Route>\n        </Switch>\n\n      </div>\n    </UserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}