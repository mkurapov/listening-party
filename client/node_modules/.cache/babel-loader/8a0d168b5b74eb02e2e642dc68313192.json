{"ast":null,"code":"import _slicedToArray from\"/Users/max/dev/listening-party/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{SocketEvent}from'../common';import axios from'axios';import{useHistory}from'react-router';import{useUser}from'../contexts/UserContext';import socket from'../socket';import{SPOTIFY_API}from'../const';var PartyPage=function PartyPage(_ref){var _currentParty$adminUs,_currentParty$users,_currentParty$playbac,_currentParty$playbac2;var match=_ref.match;var _useUser=useUser(),user=_useUser.user,isLoading=_useUser.isLoading;var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),currentParty=_useState2[0],setCurrentParty=_useState2[1];var partyId=match.params.id;var history=useHistory();var pollCurrentlyPlaying;useEffect(function(){console.log('loaded party first time');socket.on(SocketEvent.USER_LEFT_PARTY_RES,function(party){return onUserLeftParty(party);});socket.on(SocketEvent.PARTY_PLAYBACK_CHANGED_RES,function(party){return onPlaybackChanged(party);});socket.on(SocketEvent.PARTY_NOT_FOUND_RES,function(){return onPartyNotFound();});socket.on(SocketEvent.PARTY_NEW_USER_JOINED_RES,function(party){return onNewUserJoined(party);});socket.on(SocketEvent.PARTY_JOINED_RES,function(party){return onPartyJoined(party);});// NEED TO CHECK IF PARTY EXISTS HERE \nreturn function(){return handleUserLeaving();};},[]);useEffect(function(){if(!user||isLoading){console.log('You are not authed');return;}console.log('Logged in as ',user.id);socket.emit(SocketEvent.PARTY_JOINED_REQ,{user:user,socketId:socket.id,partyId:partyId});},[user]);var onUserLeftParty=function onUserLeftParty(party){var _party$adminUser,_party$adminUser2;console.log('A user left party.',party);console.log('Admin ',(_party$adminUser=party.adminUser)===null||_party$adminUser===void 0?void 0:_party$adminUser.id);console.log('User ',user===null||user===void 0?void 0:user.id);if(party&&((_party$adminUser2=party.adminUser)===null||_party$adminUser2===void 0?void 0:_party$adminUser2.id)===(user===null||user===void 0?void 0:user.id)){console.log('Youve been assigned admin.');clearInterval(pollCurrentlyPlaying);pollCurrentlyPlaying=setInterval(function(){getCurrentlyPlaying(party.id);},5000);}setCurrentParty(party);};var onPlaybackChanged=function onPlaybackChanged(party){var _party$adminUser3;console.log('Playback state changed.');var isAdminUser=((_party$adminUser3=party.adminUser)===null||_party$adminUser3===void 0?void 0:_party$adminUser3.id)===(user===null||user===void 0?void 0:user.id);if(!isAdminUser){if(party.playbackState){setCurrentlyPlaying(party.playbackState);}}setCurrentParty(party);};var onNewUserJoined=function onNewUserJoined(party){var _party$users;console.log('New user joined,',party.users?party.users[((_party$users=party.users)===null||_party$users===void 0?void 0:_party$users.length)-1]:'');setCurrentParty(party);};var onPartyNotFound=function onPartyNotFound(){console.log('This party was not found... redirecting back');setTimeout(function(){history.push('/');},2000);};var onPartyJoined=function onPartyJoined(party){var _party$adminUser4;console.log(user);if(((_party$adminUser4=party.adminUser)===null||_party$adminUser4===void 0?void 0:_party$adminUser4.id)===(user===null||user===void 0?void 0:user.id)){pollCurrentlyPlaying=setInterval(function(){getCurrentlyPlaying(party.id);},5000);}setCurrentParty(party);if(party.playbackState&&party.playbackState.is_playing){setCurrentlyPlaying(party.playbackState);}};var handleUserLeaving=function handleUserLeaving(){socket.off(SocketEvent.USER_LEFT_PARTY_RES,onUserLeftParty);socket.off(SocketEvent.PARTY_PLAYBACK_CHANGED_RES,onPlaybackChanged);socket.off(SocketEvent.PARTY_NOT_FOUND_RES,onPartyNotFound);socket.off(SocketEvent.PARTY_NEW_USER_JOINED_RES,onNewUserJoined);socket.off(SocketEvent.PARTY_JOINED_RES,onPartyJoined);clearInterval(pollCurrentlyPlaying);socket.emit(SocketEvent.USER_LEFT_PARTY_REQ);};var setCurrentlyPlaying=function setCurrentlyPlaying(playbackState){console.log('setting currently playing...',playbackState);var args={uris:[playbackState.item.uri]};axios.put(SPOTIFY_API.PLAY,args).then(function(){return console.log('Playing new song: ',playbackState.item.name);}).catch(function(err){console.log('could not set new playback state. ',err);if(err.status===404){console.log('No active device found.');}else if(err.status===403){console.log('Premium required');}});};var getCurrentlyPlaying=function getCurrentlyPlaying(partyId){console.log('Getting currently playing...');axios.get(SPOTIFY_API.CURRENTLY_PLAYING).then(function(res){socket.emit(SocketEvent.PARTY_PLAYBACK_REQ,{playbackState:res.data,partyId:partyId});}).catch(function(err){console.log('could not get currently playing');});};// const onPartyJoinedUnauthed = (numberOfUsers: number) => {\n//     console.log('PARTY JOINED BACK')\n//     setNumberOfUsers(numberOfUsers);\n// }\nreturn/*#__PURE__*/React.createElement(\"div\",null,user&&user.id?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\"A duper dope party\"),/*#__PURE__*/React.createElement(\"h2\",null,\"Hi, \",user.display_name,\"!\"),/*#__PURE__*/React.createElement(\"div\",null,\"The DJ is \",currentParty===null||currentParty===void 0?void 0:(_currentParty$adminUs=currentParty.adminUser)===null||_currentParty$adminUs===void 0?void 0:_currentParty$adminUs.display_name),/*#__PURE__*/React.createElement(\"div\",null,\"Users in party: \",currentParty===null||currentParty===void 0?void 0:(_currentParty$users=currentParty.users)===null||_currentParty$users===void 0?void 0:_currentParty$users.map(function(user){return user.display_name;}).join(', ')),(currentParty===null||currentParty===void 0?void 0:currentParty.playbackState)?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"song\"},\"Currently playing\"),/*#__PURE__*/React.createElement(\"h3\",null,currentParty===null||currentParty===void 0?void 0:(_currentParty$playbac=currentParty.playbackState)===null||_currentParty$playbac===void 0?void 0:_currentParty$playbac.item.name),/*#__PURE__*/React.createElement(\"h3\",null,currentParty===null||currentParty===void 0?void 0:(_currentParty$playbac2=currentParty.playbackState)===null||_currentParty$playbac2===void 0?void 0:_currentParty$playbac2.item.album.artists[0].name)):/*#__PURE__*/React.createElement(\"div\",null,\"No tracks playing\")):/*#__PURE__*/React.createElement(\"div\",null,\"This is a party, but you aint authed.\"));};export default PartyPage;","map":{"version":3,"sources":["/Users/max/dev/listening-party/client/src/pages/Party.tsx"],"names":["React","useEffect","useState","SocketEvent","axios","useHistory","useUser","socket","SPOTIFY_API","PartyPage","match","user","isLoading","undefined","currentParty","setCurrentParty","partyId","params","id","history","pollCurrentlyPlaying","console","log","on","USER_LEFT_PARTY_RES","party","onUserLeftParty","PARTY_PLAYBACK_CHANGED_RES","onPlaybackChanged","PARTY_NOT_FOUND_RES","onPartyNotFound","PARTY_NEW_USER_JOINED_RES","onNewUserJoined","PARTY_JOINED_RES","onPartyJoined","handleUserLeaving","emit","PARTY_JOINED_REQ","socketId","adminUser","clearInterval","setInterval","getCurrentlyPlaying","isAdminUser","playbackState","setCurrentlyPlaying","users","length","setTimeout","push","is_playing","off","USER_LEFT_PARTY_REQ","args","uris","item","uri","put","PLAY","then","name","catch","err","status","get","CURRENTLY_PLAYING","res","PARTY_PLAYBACK_REQ","data","display_name","map","join","album","artists"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport io from 'socket.io-client'\nimport { SocketEvent, Party, PlaybackState } from '../common';\nimport axios, { AxiosResponse } from 'axios';\nimport Button from '../components/Button';\nimport { getHashParams } from '../helpers/helpers';\nimport { withRouter, match, useHistory } from 'react-router';\n\nimport { useUser } from '../contexts/UserContext';\nimport socket from '../socket';\nimport { User } from '../common';\nimport { SPOTIFY_API } from '../const';\n\ninterface Props {\n    match: any;\n}\n\nconst PartyPage: React.FC<Props> = ({ match }): React.ReactElement => {\n    const { user, isLoading } = useUser();\n    const [currentParty, setCurrentParty] = useState<Party | undefined>(undefined);\n    const partyId = match.params.id;\n    const history = useHistory();\n    let pollCurrentlyPlaying: any;\n\n\n\n    useEffect(() => {\n        console.log('loaded party first time')\n\n        socket.on(SocketEvent.USER_LEFT_PARTY_RES, (party:Party) =>onUserLeftParty(party));\n        socket.on(SocketEvent.PARTY_PLAYBACK_CHANGED_RES, (party:Party) =>onPlaybackChanged(party));\n        socket.on(SocketEvent.PARTY_NOT_FOUND_RES, () => onPartyNotFound());\n        socket.on(SocketEvent.PARTY_NEW_USER_JOINED_RES,(party:Party) => onNewUserJoined(party));\n        socket.on(SocketEvent.PARTY_JOINED_RES, (party:Party) => onPartyJoined(party));\n\n        // NEED TO CHECK IF PARTY EXISTS HERE \n        return () => handleUserLeaving();\n    }, [])\n\n    useEffect(() => {\n        if (!user || isLoading) {\n            console.log('You are not authed');\n            return;\n        }\n\n        console.log('Logged in as ', user.id);\n\n        socket.emit(SocketEvent.PARTY_JOINED_REQ, { user: user, socketId: socket.id, partyId: partyId })\n    }, [user])\n\n    const onUserLeftParty = (party: Party) => {\n        console.log('A user left party.', party);\n        console.log('Admin ', party.adminUser?.id);\n        console.log('User ', user?.id);\n        if (party && party.adminUser?.id === user?.id) {\n            console.log('Youve been assigned admin.');\n            clearInterval(pollCurrentlyPlaying);\n            pollCurrentlyPlaying = setInterval(() => {\n                getCurrentlyPlaying(party.id);\n            }, 5000);\n        }\n\n        setCurrentParty(party);\n    }\n\n    const onPlaybackChanged = (party: Party) => {\n        console.log('Playback state changed.');\n        const isAdminUser = party.adminUser?.id === user?.id;\n        if (!isAdminUser) {\n            if (party.playbackState) {\n                setCurrentlyPlaying(party.playbackState);\n            }\n        }\n\n        setCurrentParty(party);\n    }\n\n    const onNewUserJoined = (party: Party) => {\n        console.log('New user joined,', party.users ? party.users[party.users?.length - 1] : '');\n        setCurrentParty(party);\n    }\n\n    const onPartyNotFound = () => {\n        console.log('This party was not found... redirecting back');\n        setTimeout(() => {\n            history.push('/');\n        }, 2000);\n    }\n\n    const onPartyJoined = (party: Party) => {\n        console.log(user);\n        if (party.adminUser?.id === user?.id) {\n            pollCurrentlyPlaying = setInterval(() => {\n                getCurrentlyPlaying(party.id);\n            }, 5000);\n        }\n        setCurrentParty(party);\n        if (party.playbackState && party.playbackState.is_playing) {\n            setCurrentlyPlaying(party.playbackState);\n        }\n    }\n\n    const handleUserLeaving = () => {\n        socket.off(SocketEvent.USER_LEFT_PARTY_RES, onUserLeftParty);\n        socket.off(SocketEvent.PARTY_PLAYBACK_CHANGED_RES, onPlaybackChanged);\n        socket.off(SocketEvent.PARTY_NOT_FOUND_RES, onPartyNotFound);\n        socket.off(SocketEvent.PARTY_NEW_USER_JOINED_RES, onNewUserJoined);\n        socket.off(SocketEvent.PARTY_JOINED_RES, onPartyJoined);\n\n        clearInterval(pollCurrentlyPlaying);\n        socket.emit(SocketEvent.USER_LEFT_PARTY_REQ)\n    }\n\n    const setCurrentlyPlaying = (playbackState: PlaybackState) => {\n        console.log('setting currently playing...', playbackState);\n        const args = {\n            uris: [playbackState.item.uri]\n        }\n        axios.put(SPOTIFY_API.PLAY, args)\n            .then(() => console.log('Playing new song: ', playbackState.item.name))\n            .catch(err => {\n                console.log('could not set new playback state. ', err)\n                if (err.status === 404) {\n                    console.log('No active device found.')\n                } else if (err.status === 403) {\n                    console.log('Premium required')\n                }\n            });\n    }\n\n    const getCurrentlyPlaying = (partyId: string) => {\n        console.log('Getting currently playing...');\n        axios.get(SPOTIFY_API.CURRENTLY_PLAYING)\n            .then((res: AxiosResponse<PlaybackState>) => {\n                socket.emit(SocketEvent.PARTY_PLAYBACK_REQ, { playbackState: res.data, partyId: partyId })\n            })\n            .catch(err => { console.log('could not get currently playing') })\n    }\n\n\n\n\n    // const onPartyJoinedUnauthed = (numberOfUsers: number) => {\n    //     console.log('PARTY JOINED BACK')\n    //     setNumberOfUsers(numberOfUsers);\n    // }\n\n    return (\n        <div>\n            {user && user.id ?\n                <div>\n                    <h1>A duper dope party</h1>\n                    <h2>Hi, {user.display_name}!</h2>\n                    <div>The DJ is {currentParty?.adminUser?.display_name}</div>\n                    <div>Users in party: {currentParty?.users?.map(user => user.display_name).join(', ')}</div>\n                    {currentParty?.playbackState ?\n                        <div>\n                            <div className=\"song\">Currently playing</div>\n                            <h3>{currentParty?.playbackState?.item.name}</h3>\n                            <h3>{currentParty?.playbackState?.item.album.artists[0].name}</h3>\n                        </div>\n                        :\n                        <div>No tracks playing</div>\n                    }\n                </div>\n                :\n                <div>This is a party, but you aint authed.</div>}\n        </div>);\n\n};\n\nexport default PartyPage;\n"]},"metadata":{},"sourceType":"module"}