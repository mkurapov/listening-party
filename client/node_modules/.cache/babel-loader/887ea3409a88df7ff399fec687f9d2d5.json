{"ast":null,"code":"import _slicedToArray from\"/Users/max/dev/listening-party/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{SocketEvent}from'../common';import{useUser}from'../contexts/UserContext';import socket from'../socket';var PartyPage=function PartyPage(_ref){var _party$users;var match=_ref.match;var _useUser=useUser(),user=_useUser.user,isLoading=_useUser.isLoading;var _useState=useState(0),_useState2=_slicedToArray(_useState,2),numberOfUsers=_useState2[0],setNumberOfUsers=_useState2[1];var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),party=_useState4[0],setParty=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),usersInParty=_useState6[0],setUsersInParty=_useState6[1];var partyId=match.params.id;socket.on(SocketEvent.PARTY_JOINED_RES,function(party){console.log('USER JOINED PARTY',party);setParty(party);});socket.on(SocketEvent.USER_LEFT_PARTY_RES,function(party){console.log('USER LEFT PARTY',party);setParty(party);});useEffect(function(){// init listeners\n//socket.on(EventType.PARTY_JOINED_UNAUTHED_RES, onPartyJoinedUnauthed);\nreturn function(){socket.emit(SocketEvent.USER_LEFT_PARTY_REQ);};},[]);useEffect(function(){console.log('changed user in party',user);if(user){socket.emit(SocketEvent.PARTY_JOINED_REQ,{user:user,socketId:socket.id,partyId:partyId});}},[user]);if(isLoading){return/*#__PURE__*/React.createElement(\"div\",null,\"Loading...\");}var onPartyJoinedUnauthed=function onPartyJoinedUnauthed(numberOfUsers){console.log('PARTY JOINED BACK');setNumberOfUsers(numberOfUsers);};return/*#__PURE__*/React.createElement(\"div\",null,user&&user.id?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\"A duper dope party\"),/*#__PURE__*/React.createElement(\"div\",null,\"Hi, \",user.id,\"!\"),/*#__PURE__*/React.createElement(\"div\",null,\"Users in there: \",party===null||party===void 0?void 0:(_party$users=party.users)===null||_party$users===void 0?void 0:_party$users.map(function(user){return user.display_name;}))):/*#__PURE__*/React.createElement(\"div\",null,\"This is a party of \",numberOfUsers,\", but you aint authed.\"));};export default PartyPage;","map":{"version":3,"sources":["/Users/max/dev/listening-party/client/src/pages/Party.tsx"],"names":["React","useEffect","useState","SocketEvent","useUser","socket","PartyPage","match","user","isLoading","numberOfUsers","setNumberOfUsers","undefined","party","setParty","usersInParty","setUsersInParty","partyId","params","id","on","PARTY_JOINED_RES","console","log","USER_LEFT_PARTY_RES","emit","USER_LEFT_PARTY_REQ","PARTY_JOINED_REQ","socketId","onPartyJoinedUnauthed","users","map","display_name"],"mappings":"wHAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CAGA,OAASC,WAAT,KAAmC,WAAnC,CAMA,OAASC,OAAT,KAAwB,yBAAxB,CACA,MAAOC,CAAAA,MAAP,KAAmB,WAAnB,CAOA,GAAMC,CAAAA,SAA0B,CAAG,QAA7BA,CAAAA,SAA6B,MAAmC,qBAAhCC,CAAAA,KAAgC,MAAhCA,KAAgC,cACtCH,OAAO,EAD+B,CAC1DI,IAD0D,UAC1DA,IAD0D,CACpDC,SADoD,UACpDA,SADoD,eAExBP,QAAQ,CAAC,CAAD,CAFgB,wCAE3DQ,aAF2D,eAE5CC,gBAF4C,8BAGxCT,QAAQ,CAAoBU,SAApB,CAHgC,yCAG3DC,KAH2D,eAGpDC,QAHoD,8BAI1BZ,QAAQ,CAAS,EAAT,CAJkB,yCAI3Da,YAJ2D,eAI7CC,eAJ6C,eAKlE,GAAMC,CAAAA,OAAO,CAAGV,KAAK,CAACW,MAAN,CAAaC,EAA7B,CAGAd,MAAM,CAACe,EAAP,CAAUjB,WAAW,CAACkB,gBAAtB,CAAwC,SAACR,KAAD,CAAkB,CACtDS,OAAO,CAACC,GAAR,CAAY,mBAAZ,CAAiCV,KAAjC,EACAC,QAAQ,CAACD,KAAD,CAAR,CACH,CAHD,EAKAR,MAAM,CAACe,EAAP,CAAUjB,WAAW,CAACqB,mBAAtB,CAA2C,SAACX,KAAD,CAAkB,CACzDS,OAAO,CAACC,GAAR,CAAY,iBAAZ,CAA+BV,KAA/B,EACAC,QAAQ,CAACD,KAAD,CAAR,CACH,CAHD,EAKAZ,SAAS,CAAC,UAAM,CACZ;AACA;AACA,MAAO,WAAM,CAAEI,MAAM,CAACoB,IAAP,CAAYtB,WAAW,CAACuB,mBAAxB,EAA8C,CAA7D,CACH,CAJQ,CAIN,EAJM,CAAT,CAOAzB,SAAS,CAAC,UAAM,CACZqB,OAAO,CAACC,GAAR,CAAY,uBAAZ,CAAqCf,IAArC,EACA,GAAIA,IAAJ,CAAU,CACNH,MAAM,CAACoB,IAAP,CAAYtB,WAAW,CAACwB,gBAAxB,CAA0C,CAAEnB,IAAI,CAAEA,IAAR,CAAcoB,QAAQ,CAAEvB,MAAM,CAACc,EAA/B,CAAmCF,OAAO,CAAEA,OAA5C,CAA1C,EACH,CACJ,CALQ,CAKN,CAACT,IAAD,CALM,CAAT,CAOA,GAAIC,SAAJ,CAAe,CACX,mBAAO,4CAAP,CACH,CAOD,GAAMoB,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,CAACnB,aAAD,CAA2B,CACrDY,OAAO,CAACC,GAAR,CAAY,mBAAZ,EACAZ,gBAAgB,CAACD,aAAD,CAAhB,CACH,CAHD,CAKA,mBACI,+BACKF,IAAI,EAAIA,IAAI,CAACW,EAAb,cACG,4CACI,mDADJ,cAEI,sCAAUX,IAAI,CAACW,EAAf,KAFJ,cAGI,kDAAsBN,KAAtB,SAAsBA,KAAtB,+BAAsBA,KAAK,CAAEiB,KAA7B,uCAAsB,aAAcC,GAAd,CAAkB,SAAAvB,IAAI,QAAIA,CAAAA,IAAI,CAACwB,YAAT,EAAtB,CAAtB,CAHJ,CADH,cAOG,qDAAyBtB,aAAzB,0BARR,CADJ,CAYH,CA1DD,CA4DA,cAAeJ,CAAAA,SAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport io from 'socket.io-client'\nimport { SocketEvent, Party } from '../common';\nimport axios from 'axios';\nimport Button from '../components/Button';\nimport { getHashParams } from '../helpers/helpers';\nimport { withRouter, match } from 'react-router';\n\nimport { useUser } from '../contexts/UserContext';\nimport socket from '../socket';\nimport { User } from '../common';\n\ninterface Props {\n    match: any;\n}\n\nconst PartyPage: React.FC<Props> = ({ match }): React.ReactElement => {\n    const { user, isLoading } = useUser();\n    const [numberOfUsers, setNumberOfUsers] = useState(0);\n    const [party, setParty] = useState<Party | undefined>(undefined);\n    const [usersInParty, setUsersInParty] = useState<User[]>([]);\n    const partyId = match.params.id;\n\n\n    socket.on(SocketEvent.PARTY_JOINED_RES, (party: Party) => {\n        console.log('USER JOINED PARTY', party);\n        setParty(party);\n    });\n\n    socket.on(SocketEvent.USER_LEFT_PARTY_RES, (party: Party) => {\n        console.log('USER LEFT PARTY', party);\n        setParty(party);\n    });\n\n    useEffect(() => {\n        // init listeners\n        //socket.on(EventType.PARTY_JOINED_UNAUTHED_RES, onPartyJoinedUnauthed);\n        return () => { socket.emit(SocketEvent.USER_LEFT_PARTY_REQ) };\n    }, [])\n\n\n    useEffect(() => {\n        console.log('changed user in party', user);\n        if (user) {\n            socket.emit(SocketEvent.PARTY_JOINED_REQ, { user: user, socketId: socket.id, partyId: partyId })\n        }\n    }, [user])\n\n    if (isLoading) {\n        return <div>Loading...</div>\n    }\n\n\n\n\n\n\n    const onPartyJoinedUnauthed = (numberOfUsers: number) => {\n        console.log('PARTY JOINED BACK')\n        setNumberOfUsers(numberOfUsers);\n    }\n\n    return (\n        <div>\n            {user && user.id ?\n                <div>\n                    <h1>A duper dope party</h1>\n                    <div>Hi, {user.id}!</div>\n                    <div>Users in there: {party?.users?.map(user => user.display_name)}</div>\n                </div>\n                :\n                <div>This is a party of {numberOfUsers}, but you aint authed.</div>}\n        </div>);\n\n};\n\nexport default PartyPage;\n"]},"metadata":{},"sourceType":"module"}