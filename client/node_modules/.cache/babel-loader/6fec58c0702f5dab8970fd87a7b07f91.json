{"ast":null,"code":"var _jsxFileName = \"/Users/max/dev/listening-party/client/src/contexts/UserContext.tsx\";\nimport React, { useState, useEffect, useMemo, createContext, useContext } from \"react\";\nimport axios from 'axios';\nimport API_ENDPOINTS from '../endpoints';\nimport { getHashParams } from '../helpers/helpers';\nconst UserContext = createContext({\n  user: undefined,\n  logout: () => {}\n});\n\nconst UserProvider = ({\n  children\n}) => {\n  const [user, setUser] = useState();\n\n  const checkLogIn = () => {};\n\n  useEffect(() => {\n    console.log('checklogin');\n    const savedUser = localStorage.getItem('user');\n\n    if (savedUser) {\n      setUser(JSON.parse(savedUser));\n      return;\n    }\n\n    if (!window.location.hash) return;\n    login();\n  }, []);\n\n  const login = () => {\n    let locationArgs = getHashParams(window.location.hash);\n    axios.defaults.headers.common['Authorization'] = 'Bearer ' + locationArgs.access_token;\n    axios.get(API_ENDPOINTS.ME).then(res => {\n      const user = res.data;\n      setUser(user);\n      localStorage.setItem('user', JSON.stringify(user)); // socket.emit('newconnection', user);\n    });\n  };\n\n  const logout = () => {\n    setUser(undefined);\n    localStorage.clear();\n  };\n\n  const SettingsContext = useMemo(() => ({\n    user,\n    logout\n  }), [user, logout]); // if (!user) {\n  //     return <div>no</div>\n  // }\n\n  return /*#__PURE__*/React.createElement(UserContext.Provider, {\n    value: SettingsContext,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 9\n    }\n  }, children);\n};\n\nconst useUser = () => useContext(UserContext);\n\nexport { UserProvider, useUser };","map":{"version":3,"sources":["/Users/max/dev/listening-party/client/src/contexts/UserContext.tsx"],"names":["React","useState","useEffect","useMemo","createContext","useContext","axios","API_ENDPOINTS","getHashParams","UserContext","user","undefined","logout","UserProvider","children","setUser","checkLogIn","console","log","savedUser","localStorage","getItem","JSON","parse","window","location","hash","login","locationArgs","defaults","headers","common","access_token","get","ME","then","res","data","setItem","stringify","clear","SettingsContext","useUser"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAkDC,OAAlD,EAA2DC,aAA3D,EAA0EC,UAA1E,QAA4F,OAA5F;AAEA,OAAOC,KAAP,MAAqC,OAArC;AAEA,OAAOC,aAAP,MAA0B,cAA1B;AAEA,SAASC,aAAT,QAA8B,oBAA9B;AAaA,MAAMC,WAAW,GAAGL,aAAa,CAAc;AAC3CM,EAAAA,IAAI,EAAEC,SADqC;AAE3CC,EAAAA,MAAM,EAAE,MAAM,CAAG;AAF0B,CAAd,CAAjC;;AAKA,MAAMC,YAAsB,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAsC;AACjE,QAAM,CAACJ,IAAD,EAAOK,OAAP,IAAkBd,QAAQ,EAAhC;;AAIA,QAAMe,UAAU,GAAG,MAAY,CAE9B,CAFD;;AAIAd,EAAAA,SAAS,CAAC,MAAM;AACZe,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACA,UAAMC,SAAS,GAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAlB;;AACA,QAAIF,SAAJ,EAAe;AACXJ,MAAAA,OAAO,CAACO,IAAI,CAACC,KAAL,CAAWJ,SAAX,CAAD,CAAP;AACA;AACH;;AAED,QAAI,CAACK,MAAM,CAACC,QAAP,CAAgBC,IAArB,EAA2B;AAC3BC,IAAAA,KAAK;AACR,GAVQ,EAUN,EAVM,CAAT;;AAcA,QAAMA,KAAK,GAAG,MAAY;AACtB,QAAIC,YAA4B,GAAGpB,aAAa,CAACgB,MAAM,CAACC,QAAP,CAAgBC,IAAjB,CAAhD;AACApB,IAAAA,KAAK,CAACuB,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,eAA9B,IAAiD,YAAYH,YAAY,CAACI,YAA1E;AACA1B,IAAAA,KAAK,CAAC2B,GAAN,CAAU1B,aAAa,CAAC2B,EAAxB,EAA4BC,IAA5B,CAAkCC,GAAD,IAA8B;AAC3D,YAAM1B,IAAI,GAAG0B,GAAG,CAACC,IAAjB;AACAtB,MAAAA,OAAO,CAACL,IAAD,CAAP;AACAU,MAAAA,YAAY,CAACkB,OAAb,CAAqB,MAArB,EAA6BhB,IAAI,CAACiB,SAAL,CAAe7B,IAAf,CAA7B,EAH2D,CAI3D;AACH,KALD;AAMH,GATD;;AAWA,QAAME,MAAM,GAAG,MAAY;AACvBG,IAAAA,OAAO,CAACJ,SAAD,CAAP;AACAS,IAAAA,YAAY,CAACoB,KAAb;AACH,GAHD;;AAKA,QAAMC,eAAe,GAAGtC,OAAO,CAAC,OAAO;AACnCO,IAAAA,IADmC;AAEnCE,IAAAA;AAFmC,GAAP,CAAD,EAG3B,CAACF,IAAD,EAAOE,MAAP,CAH2B,CAA/B,CAvCiE,CA4CjE;AACA;AACA;;AAEA,sBACI,oBAAC,WAAD,CAAa,QAAb;AAAsB,IAAA,KAAK,EAAE6B,eAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACK3B,QADL,CADJ;AAKH,CArDD;;AAuDA,MAAM4B,OAAO,GAAG,MAAMrC,UAAU,CAACI,WAAD,CAAhC;;AACA,SAASI,YAAT,EAAuB6B,OAAvB","sourcesContent":["import React, { useState, useEffect, useCallback, useMemo, createContext, useContext } from \"react\";\n\nimport axios, { AxiosResponse } from 'axios';\nimport { User } from '../../../models/User';\nimport API_ENDPOINTS from '../endpoints'\n\nimport { getHashParams } from '../helpers/helpers';\n\ninterface AuthHashParams {\n    access_token: string;\n    token_type: string;\n}\n\n\nexport interface UserContext {\n    user: User | undefined;\n    logout: () => void;\n}\n\nconst UserContext = createContext<UserContext>({\n    user: undefined,\n    logout: () => { },\n});\n\nconst UserProvider: React.FC = ({ children }): React.ReactElement => {\n    const [user, setUser] = useState<User>();\n\n\n\n    const checkLogIn = (): void => {\n\n    }\n\n    useEffect(() => {\n        console.log('checklogin')\n        const savedUser = localStorage.getItem('user');\n        if (savedUser) {\n            setUser(JSON.parse(savedUser));\n            return;\n        }\n\n        if (!window.location.hash) return;\n        login();\n    }, [])\n\n\n\n    const login = (): void => {\n        let locationArgs: AuthHashParams = getHashParams(window.location.hash);\n        axios.defaults.headers.common['Authorization'] = 'Bearer ' + locationArgs.access_token;\n        axios.get(API_ENDPOINTS.ME).then((res: AxiosResponse<User>) => {\n            const user = res.data;\n            setUser(user)\n            localStorage.setItem('user', JSON.stringify(user));\n            // socket.emit('newconnection', user);\n        });\n    }\n\n    const logout = (): void => {\n        setUser(undefined);\n        localStorage.clear();\n    }\n\n    const SettingsContext = useMemo(() => ({\n        user,\n        logout\n    }), [user, logout]);\n\n    // if (!user) {\n    //     return <div>no</div>\n    // }\n\n    return (\n        <UserContext.Provider value={SettingsContext}>\n            {children}\n        </UserContext.Provider>\n    );\n};\n\nconst useUser = () => useContext(UserContext);\nexport { UserProvider, useUser };\n\n"]},"metadata":{},"sourceType":"module"}