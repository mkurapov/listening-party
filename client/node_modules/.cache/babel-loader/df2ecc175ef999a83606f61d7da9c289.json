{"ast":null,"code":"import _slicedToArray from\"/Users/max/dev/listening-party/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useMemo,createContext,useContext}from\"react\";import axios from'axios';import{getHashParams}from'../helpers/helpers';import{SPOTIFY_API}from\"../const\";var UserContext=createContext({user:undefined,isLoading:false,logout:function logout(){}});var UserProvider=function UserProvider(_ref){var children=_ref.children;var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];useEffect(function(){var savedUser=localStorage.getItem('user');var savedAccessToken=localStorage.getItem('access_token');var savedRefreshToken=localStorage.getItem('access_token');console.log('checking login ',savedUser);if(!savedUser||!savedAccessToken||!savedRefreshToken){if(!window.location.hash)return;login();}if(savedUser){setUser(JSON.parse(savedUser));setIsLoading(false);}},[]);var login=function login(){var locationArgs=getHashParams(window.location.hash);axios.defaults.headers.common['Authorization']='Bearer '+locationArgs.access_token;axios.get(SPOTIFY_API.ME).then(function(res){var user=res.data;setUser(user);// socket.emit(SocketEvent.USER_CONNECTED_REQ, user);\nlocalStorage.setItem('user',JSON.stringify(user));localStorage.setItem('access_token',locationArgs.access_token);localStorage.setItem('refresh_token',locationArgs.refresh_token);});};var logout=function logout(){// socket.emit(SocketEvent.USER_DISCONNECTED_REQ, user);\nsetUser(undefined);localStorage.clear();};var SettingsContext=useMemo(function(){return{user:user,isLoading:isLoading,logout:logout};},[user,logout]);return/*#__PURE__*/React.createElement(UserContext.Provider,{value:SettingsContext},children);};var useUser=function useUser(){return useContext(UserContext);};export{UserProvider,useUser};","map":{"version":3,"sources":["/Users/max/dev/listening-party/client/src/contexts/UserContext.tsx"],"names":["React","useState","useEffect","useMemo","createContext","useContext","axios","getHashParams","SPOTIFY_API","UserContext","user","undefined","isLoading","logout","UserProvider","children","setUser","setIsLoading","savedUser","localStorage","getItem","savedAccessToken","savedRefreshToken","console","log","window","location","hash","login","JSON","parse","locationArgs","defaults","headers","common","access_token","get","ME","then","res","data","setItem","stringify","refresh_token","clear","SettingsContext","useUser"],"mappings":"wHAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAkDC,OAAlD,CAA2DC,aAA3D,CAA0EC,UAA1E,KAA4F,OAA5F,CAEA,MAAOC,CAAAA,KAAP,KAAqC,OAArC,CAGA,OAASC,aAAT,KAA8B,oBAA9B,CACA,OAASC,WAAT,KAA4B,UAA5B,CAeA,GAAMC,CAAAA,WAAW,CAAGL,aAAa,CAAc,CAC3CM,IAAI,CAAEC,SADqC,CAE3CC,SAAS,CAAE,KAFgC,CAG3CC,MAAM,CAAE,iBAAM,CAAG,CAH0B,CAAd,CAAjC,CAMA,GAAMC,CAAAA,YAAsB,CAAG,QAAzBA,CAAAA,YAAyB,MAAsC,IAAnCC,CAAAA,QAAmC,MAAnCA,QAAmC,eACzCd,QAAQ,EADiC,wCAC1DS,IAD0D,eACpDM,OADoD,8BAE/Bf,QAAQ,CAAC,IAAD,CAFuB,yCAE1DW,SAF0D,eAE/CK,YAF+C,eAIjEf,SAAS,CAAC,UAAM,CACZ,GAAMgB,CAAAA,SAAS,CAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAlB,CACA,GAAMC,CAAAA,gBAAgB,CAAGF,YAAY,CAACC,OAAb,CAAqB,cAArB,CAAzB,CACA,GAAME,CAAAA,iBAAiB,CAAGH,YAAY,CAACC,OAAb,CAAqB,cAArB,CAA1B,CACAG,OAAO,CAACC,GAAR,CAAY,iBAAZ,CAA+BN,SAA/B,EAEA,GAAI,CAACA,SAAD,EAAc,CAACG,gBAAf,EAAmC,CAACC,iBAAxC,CAA2D,CACvD,GAAI,CAACG,MAAM,CAACC,QAAP,CAAgBC,IAArB,CAA2B,OAC3BC,KAAK,GACR,CAED,GAAIV,SAAJ,CAAe,CACXF,OAAO,CAACa,IAAI,CAACC,KAAL,CAAWZ,SAAX,CAAD,CAAP,CACAD,YAAY,CAAC,KAAD,CAAZ,CACH,CACJ,CAfQ,CAeN,EAfM,CAAT,CAiBA,GAAMW,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,EAAY,CACtB,GAAIG,CAAAA,YAA4B,CAAGxB,aAAa,CAACkB,MAAM,CAACC,QAAP,CAAgBC,IAAjB,CAAhD,CACArB,KAAK,CAAC0B,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,eAA9B,EAAiD,UAAYH,YAAY,CAACI,YAA1E,CACA7B,KAAK,CAAC8B,GAAN,CAAU5B,WAAW,CAAC6B,EAAtB,EAA0BC,IAA1B,CAA+B,SAACC,GAAD,CAA8B,CACzD,GAAM7B,CAAAA,IAAI,CAAG6B,GAAG,CAACC,IAAjB,CACAxB,OAAO,CAACN,IAAD,CAAP,CACA;AACAS,YAAY,CAACsB,OAAb,CAAqB,MAArB,CAA6BZ,IAAI,CAACa,SAAL,CAAehC,IAAf,CAA7B,EACAS,YAAY,CAACsB,OAAb,CAAqB,cAArB,CAAqCV,YAAY,CAACI,YAAlD,EACAhB,YAAY,CAACsB,OAAb,CAAqB,eAArB,CAAsCV,YAAY,CAACY,aAAnD,EACH,CAPD,EAQH,CAXD,CAaA,GAAM9B,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAY,CACvB;AACAG,OAAO,CAACL,SAAD,CAAP,CACAQ,YAAY,CAACyB,KAAb,GACH,CAJD,CAMA,GAAMC,CAAAA,eAAe,CAAG1C,OAAO,CAAC,iBAAO,CACnCO,IAAI,CAAJA,IADmC,CAEnCE,SAAS,CAATA,SAFmC,CAGnCC,MAAM,CAANA,MAHmC,CAAP,EAAD,CAI3B,CAACH,IAAD,CAAOG,MAAP,CAJ2B,CAA/B,CAMA,mBACI,oBAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAEgC,eAA7B,EACK9B,QADL,CADJ,CAKH,CAnDD,CAqDA,GAAM+B,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,SAAMzC,CAAAA,UAAU,CAACI,WAAD,CAAhB,EAAhB,CACA,OAASK,YAAT,CAAuBgC,OAAvB","sourcesContent":["import React, { useState, useEffect, useCallback, useMemo, createContext, useContext } from \"react\";\n\nimport axios, { AxiosResponse } from 'axios';\nimport { User, SocketEvent } from '../common';\n\nimport { getHashParams } from '../helpers/helpers';\nimport { SPOTIFY_API } from \"../const\";\nimport socket from \"../socket\";\n\ninterface AuthHashParams {\n    access_token: string;\n    token_type: string;\n}\n\n\nexport interface UserContext {\n    user: User | undefined;\n    isLoading: boolean;\n    logout: () => void;\n}\n\nconst UserContext = createContext<UserContext>({\n    user: undefined,\n    isLoading: false,\n    logout: () => { },\n});\n\nconst UserProvider: React.FC = ({ children }): React.ReactElement => {\n    const [user, setUser] = useState<User>();\n    const [isLoading, setIsLoading] = useState(true);\n\n    useEffect(() => {\n        const savedUser = localStorage.getItem('user');\n        const savedAccessToken = localStorage.getItem('access_token');\n        const savedRefreshToken = localStorage.getItem('access_token');\n        console.log('checking login ', savedUser)\n\n        if (!savedUser || !savedAccessToken || !savedRefreshToken) {\n            if (!window.location.hash) return;\n            login();\n        }\n\n        if (savedUser) {\n            setUser(JSON.parse(savedUser));\n            setIsLoading(false);\n        }\n    }, [])\n\n    const login = (): void => {\n        let locationArgs: AuthHashParams = getHashParams(window.location.hash);\n        axios.defaults.headers.common['Authorization'] = 'Bearer ' + locationArgs.access_token;\n        axios.get(SPOTIFY_API.ME).then((res: AxiosResponse<User>) => {\n            const user = res.data;\n            setUser(user);\n            // socket.emit(SocketEvent.USER_CONNECTED_REQ, user);\n            localStorage.setItem('user', JSON.stringify(user));\n            localStorage.setItem('access_token', locationArgs.access_token);\n            localStorage.setItem('refresh_token', locationArgs.refresh_token);\n        });\n    }\n\n    const logout = (): void => {\n        // socket.emit(SocketEvent.USER_DISCONNECTED_REQ, user);\n        setUser(undefined);\n        localStorage.clear();\n    }\n\n    const SettingsContext = useMemo(() => ({\n        user,\n        isLoading,\n        logout\n    }), [user, logout]);\n\n    return (\n        <UserContext.Provider value={SettingsContext}>\n            {children}\n        </UserContext.Provider>\n    );\n};\n\nconst useUser = () => useContext(UserContext);\nexport { UserProvider, useUser };\n\n"]},"metadata":{},"sourceType":"module"}